<!-- Audit Trail Section -->
<div id="audit" class="audit-trail-section">
  <div class="section-header">
    <h2>Audit Trail</h2>
    <div class="header-actions">
      <button class="btn-secondary" (click)="exportAuditTrail()">
        <i class="fas fa-download"></i>
        Export Logs
      </button>
      <button class="btn-danger" (click)="clearAuditTrail()">
        <i class="fas fa-trash"></i>
        Clear All
      </button>
    </div>
  </div>

  <!-- Audit Trail Filters -->
  <div class="audit-filters">
    <div class="filters-grid">
      <div class="filter-item">
        <label>Date Range</label>
        <select class="form-control" [(ngModel)]="auditFilters.dateRange">
          <option value="">All Time</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="quarter">This Quarter</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Department</label>
        <select class="form-control" [(ngModel)]="auditFilters.department">
          <option value="">All Departments</option>
          <option value="HR">Human Resources</option>
          <option value="Finance">Finance</option>
          <option value="IT">IT Department</option>
          <option value="Operations">Operations</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Action</label>
        <select class="form-control" [(ngModel)]="auditFilters.action">
          <option value="">All Actions</option>
          <option value="generated">Generated</option>
          <option value="exported">Exported</option>
          <option value="printed">Printed</option>
          <option value="deleted">Deleted</option>
          <option value="modified">Modified</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Status</label>
        <select class="form-control" [(ngModel)]="auditFilters.status">
          <option value="">All Status</option>
          <option value="success">Success</option>
          <option value="failed">Failed</option>
          <option value="pending">Pending</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Report Type</label>
        <select class="form-control" [(ngModel)]="auditFilters.reportType">
          <option value="">All Types</option>
          <option value="employee">Employee</option>
          <option value="payroll">Payroll</option>
          <option value="attendance">Attendance</option>
          <option value="leave">Leave</option>
          <option value="performance">Performance</option>
        </select>
      </div>
      <div class="filter-item">
        <button class="btn-primary" (click)="filterAuditTrails()">
          <i class="fas fa-filter"></i>
          Apply Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Audit Trail Table -->
  <div class="audit-table">
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Action</th>
            <th>Report Name</th>
            <th>Generated By</th>
            <th>Department</th>
            <th>Date & Time</th>
            <th>Status</th>
            <th>File Size</th>
            <th>Downloads</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let audit of auditTrails">
            <td>
              <div class="action-cell">
                <i [class]="getActionIcon(audit.action)" 
                   [style.color]="getActionColor(audit.action)"></i>
                <span class="action-text">{{ audit.action }}</span>
              </div>
            </td>
            <td>
              <div class="report-info">
                <span class="report-name">{{ audit.reportName }}</span>
                <span class="report-type">{{ audit.reportType }}</span>
              </div>
            </td>
            <td>
              <div class="user-info">
                <span class="user-email">{{ audit.generatedBy }}</span>
                <span class="ip-address">{{ audit.ipAddress }}</span>
              </div>
            </td>
            <td>
              <span class="department-badge">{{ audit.department }}</span>
            </td>
            <td>
              <div class="datetime-info">
                <span class="datetime">{{ formatDate(audit.generatedAt) }}</span>
                <span class="time-ago">{{ getTimeAgo(audit.generatedAt) }}</span>
              </div>
            </td>
            <td>
              <div class="status-cell">
                <i [class]="getStatusIcon(audit.status)" 
                   [style.color]="getStatusColor(audit.status)"></i>
                <span class="status-text">{{ audit.status }}</span>
              </div>
            </td>
            <td>
              <span class="file-size">{{ audit.fileSize }}</span>
            </td>
            <td>
              <span class="download-count">{{ audit.downloadCount }}</span>
            </td>
            <td>
              <div class="audit-actions">
                <button class="btn-icon" title="View Details" (click)="viewAuditTrail(audit)">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon" 
                        (click)="deleteAuditTrail(audit.id)"
                        title="Delete Record">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <div class="pagination">
        <button class="btn-page" disabled>
          <i class="fas fa-chevron-left"></i>
        </button>
        <span class="page-info">Page 1 of 1</span>
        <button class="btn-page" disabled>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      <div class="page-size">
        <span>Show:</span>
        <select class="form-control">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>entries</span>
      </div>
    </div>
  </div>
</div>

<!-- View Audit Trail Modal -->
<div class="modal" *ngIf="showViewModal">
  <div class="modal-overlay" (click)="closeViewModal()"></div>
  <div class="modal-content audit-modal-animate">
    <div class="modal-header improved-modal-header">
      <div class="header-left">
        <span class="modal-icon"><i [class]="getActionIcon(selectedAudit?.action || '')" [style.color]="getActionColor(selectedAudit?.action || '')"></i></span>
        <div>
          <h2>Audit Trail Details</h2>
          <div class="modal-subtitle">Full log information</div>
        </div>
      </div>
      <button class="btn-icon close-btn-lg" (click)="closeViewModal()" title="Close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body improved-modal-body" *ngIf="selectedAudit">
      <div class="audit-detail-grid">
        <div class="audit-detail-row">
          <span class="label">Action:</span>
          <span><span class="badge-action" [style.background]="getActionColor(selectedAudit.action)"><i [class]="getActionIcon(selectedAudit.action)"></i> {{ selectedAudit.action }}</span></span>
        </div>
        <div class="audit-detail-row">
          <span class="label">Status:</span>
          <span><span class="badge-status" [style.background]="getStatusColor(selectedAudit.status)"><i [class]="getStatusIcon(selectedAudit.status)"></i> {{ selectedAudit.status }}</span></span>
        </div>
        <div class="audit-detail-row"><span class="label">Report Name:</span> <span>{{ selectedAudit.reportName }}</span></div>
        <div class="audit-detail-row"><span class="label">Report Type:</span> <span>{{ selectedAudit.reportType }}</span></div>
        <div class="audit-detail-row"><span class="label">Generated By:</span> <span>{{ selectedAudit.generatedBy }}</span></div>
        <div class="audit-detail-row"><span class="label">Department:</span> <span>{{ selectedAudit.department }}</span></div>
        <div class="audit-detail-row"><span class="label">Date & Time:</span> <span>{{ formatDate(selectedAudit.generatedAt) }}</span></div>
        <div class="audit-detail-row"><span class="label">File Size:</span> <span>{{ selectedAudit.fileSize }}</span></div>
        <div class="audit-detail-row"><span class="label">Download Count:</span> <span>{{ selectedAudit.downloadCount }}</span></div>
        <div class="audit-detail-row"><span class="label">IP Address:</span> <span>{{ selectedAudit.ipAddress }}</span></div>
        <div class="audit-detail-row"><span class="label">User Agent:</span> <span>{{ selectedAudit.userAgent }}</span></div>
        <div class="audit-detail-row"><span class="label">Filters:</span> <span>{{ selectedAudit.filters.join(', ') }}</span></div>
        <div class="audit-detail-row"><span class="label">Template Used:</span> <span>{{ selectedAudit.templateUsed }}</span></div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" (click)="closeViewModal()">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>
</div>
