<div class="admin-custom-container">
  <div class="page-header">
    <h1>{{ title }}</h1>
    <p>Super Admin tools for system monitoring, alert management, and custom reporting</p>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'alerts'"
      (click)="setActiveTab('alerts')">
      <span class="tab-icon">üö®</span>
      Real-time Alerts
      <span class="badge" *ngIf="getUnreadAlertsCount() > 0">{{ getUnreadAlertsCount() }}</span>
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'rules'"
      (click)="setActiveTab('rules')">
      <span class="tab-icon">‚öôÔ∏è</span>
      Alert Rules
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'reports'"
      (click)="setActiveTab('reports')">
      <span class="tab-icon">üìä</span>
      Custom Reports
    </button>
  </div>

  <!-- Floating Action Button (FAB) -->
  <button 
    class="fab" 
    *ngIf="activeTab === 'rules' || activeTab === 'reports'"
    (click)="onFabClick()"
    [attr.aria-label]="activeTab === 'rules' ? 'Create New Rule' : 'Create New Report'"
    [title]="activeTab === 'rules' ? 'Create New Rule' : 'Create New Report'">
    <span *ngIf="activeTab === 'rules'">+</span>
    <span *ngIf="activeTab === 'reports'">+</span>
  </button>

  <!-- Alerts Tab -->
  <div class="tab-content" *ngIf="activeTab === 'alerts'">
    <div class="section-header">
      <h2>Real-time System Alerts</h2>
      <p>Monitor critical system issues, security breaches, and data inconsistencies</p>
    </div>

    <div class="alerts-container">
      <div class="alert-card" 
           *ngFor="let alert of alerts" 
           [class.unread]="!alert.isRead"
           [class.critical]="alert.type === 'critical'"
           [class.warning]="alert.type === 'warning'"
           [class.info]="alert.type === 'info'">
        
        <div class="alert-header">
          <div class="card-avatar" [ngClass]="{'critical': alert.type === 'critical', 'warning': alert.type === 'warning', 'info': alert.type === 'info'}">
            {{ getAlertIcon(alert.type) }}
          </div>
          <div class="alert-info">
            <h3>{{ alert.title }}</h3>
            <span class="alert-category">{{ alert.category }}</span>
            <span class="alert-time">{{ alert.timestamp | date:'short' }}</span>
          </div>
          <div class="alert-actions">
            <button class="btn-icon" 
                    *ngIf="!alert.isRead"
                    (click)="markAlertAsRead(alert.id)"
                    title="Mark as read"
                    aria-label="Mark as read">
              ‚úì
              <span class="tooltip">Mark as read</span>
            </button>
            <button class="btn-icon delete" 
                    (click)="deleteAlert(alert.id)"
                    title="Delete alert"
                    aria-label="Delete alert">
              √ó
              <span class="tooltip">Delete alert</span>
            </button>
          </div>
        </div>
        
        <div class="alert-message">
          <p>{{ alert.message }}</p>
        </div>
      </div>

      <div class="empty-state" *ngIf="alerts.length === 0">
        <div class="empty-icon">üéâ</div>
        <h3>No Alerts</h3>
        <p>All systems are running smoothly!<br>You're all caught up. üöÄ</p>
      </div>
    </div>
  </div>

  <!-- Rules Tab -->
  <div class="tab-content" *ngIf="activeTab === 'rules'">
    <div class="section-header">
      <h2>Alert Rules & Notification Preferences</h2>
      <p>Create, edit, and manage custom alert rules and notification settings</p>
    </div>

    <!-- New Rule Form -->
    <div class="form-overlay" *ngIf="showNewRuleForm">
      <div class="form-card">
        <div class="form-header">
          <h3>{{ editingRule ? 'Edit Alert Rule' : 'Create New Alert Rule' }}</h3>
          <button class="btn-icon" (click)="cancelEditRule()">√ó</button>
        </div>
        
        <form (ngSubmit)="editingRule ? updateRule() : createNewRule()">
          <div class="form-group">
            <label>Rule Name</label>
            <input type="text" 
                   [(ngModel)]="ruleName" 
                   name="name"
                   placeholder="Enter rule name"
                   required>
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea [(ngModel)]="ruleDescription" 
                      name="description"
                      placeholder="Describe what this rule monitors"
                      required></textarea>
          </div>
          
          <div class="form-group">
            <label>Condition</label>
            <input type="text" 
                   [(ngModel)]="ruleCondition" 
                   name="condition"
                   placeholder="e.g., failed_logins > 5 within 10 minutes"
                   required>
          </div>
          
          <div class="form-group">
            <label>Severity Level</label>
            <select [(ngModel)]="ruleSeverity" 
                    name="severity">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Notifications</label>
            <div class="checkbox-group">
              <label><input type="checkbox" 
                           [checked]="(editingRule ? editingRule.notifications : newRule.notifications).includes('email')"
                           (change)="toggleNotification('email')"> Email</label>
              <label><input type="checkbox" 
                           [checked]="(editingRule ? editingRule.notifications : newRule.notifications).includes('sms')"
                           (change)="toggleNotification('sms')"> SMS</label>
              <label><input type="checkbox" 
                           [checked]="(editingRule ? editingRule.notifications : newRule.notifications).includes('dashboard')"
                           (change)="toggleNotification('dashboard')"> Dashboard</label>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelEditRule()">Cancel</button>
            <button type="submit" class="btn btn-primary">
              {{ editingRule ? 'Update Rule' : 'Create Rule' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Rules List -->
    <div class="rules-container">
      <div class="rule-card" *ngFor="let rule of alertRules">
        <div class="rule-header">
          <div class="card-avatar"><span>‚öôÔ∏è</span></div>
          <div class="rule-info">
            <h3>{{ rule.name }}</h3>
            <p>{{ rule.description }}</p>
          </div>
          <div class="rule-status">
            <span class="status-badge" 
                  [class.active]="rule.isActive"
                  [class.inactive]="!rule.isActive">
              {{ rule.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
        
        <div class="rule-details">
          <div class="detail-item">
            <strong>Condition:</strong> {{ rule.condition }}
          </div>
          <div class="detail-item">
            <strong>Severity:</strong> 
            <span class="severity-badge" [style.background-color]="getSeverityColor(rule.severity)">
              {{ rule.severity }}
            </span>
          </div>
          <div class="detail-item">
            <strong>Notifications:</strong> {{ rule.notifications.join(', ') }}
          </div>
        </div>
        
        <div class="rule-actions">
          <button class="btn btn-secondary" 
                  (click)="toggleRuleStatus(rule.id)"
                  title="Toggle status"
                  aria-label="Toggle status">
            {{ rule.isActive ? 'Deactivate' : 'Activate' }}
            <span class="tooltip">{{ rule.isActive ? 'Deactivate' : 'Activate' }}</span>
          </button>
          <button class="btn btn-secondary" 
                  (click)="editRule(rule)"
                  title="Edit rule"
                  aria-label="Edit rule">
            Edit
            <span class="tooltip">Edit rule</span>
          </button>
          <button class="btn btn-danger" 
                  (click)="deleteRule(rule.id)"
                  title="Delete rule"
                  aria-label="Delete rule">
            Delete
            <span class="tooltip">Delete rule</span>
          </button>
        </div>
      </div>
      <div class="empty-state" *ngIf="alertRules.length === 0">
        <div class="empty-icon">‚öôÔ∏è</div>
        <h3>No Rules</h3>
        <p>Start by creating your first alert rule!<br>Click the + button below. ‚ú®</p>
      </div>
    </div>
  </div>

  <!-- Reports Tab -->
  <div class="tab-content" *ngIf="activeTab === 'reports'">
    <div class="section-header">
      <h2>Custom Graphical Reports</h2>
      <p>Create, manage, and view customizable reports for organizational metrics</p>
    </div>

    <!-- New Report Form -->
    <div class="form-overlay" *ngIf="showNewReportForm">
      <div class="form-card">
        <div class="form-header">
          <h3>{{ editingReport ? 'Edit Report' : 'Create New Report' }}</h3>
          <button class="btn-icon" (click)="cancelEditReport()">√ó</button>
        </div>
        
        <form (ngSubmit)="editingReport ? updateReport() : createNewReport()">
          <div class="form-group">
            <label>Report Name</label>
            <input type="text" 
                   [(ngModel)]="reportName" 
                   name="name"
                   placeholder="Enter report name"
                   required>
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <textarea [(ngModel)]="reportDescription" 
                      name="description"
                      placeholder="Describe what this report shows"
                      required></textarea>
          </div>
          
          <div class="form-group">
            <label>Report Type</label>
            <select [(ngModel)]="reportType" 
                    name="type">
              <option value="chart">Chart</option>
              <option value="table">Table</option>
              <option value="dashboard">Dashboard</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Metrics to Include</label>
            <div class="checkbox-group">
              <label><input type="checkbox" 
                           [checked]="(editingReport ? editingReport.metrics : newReport.metrics).includes('employee_count')"
                           (change)="toggleMetric('employee_count')"> Employee Count</label>
              <label><input type="checkbox" 
                           [checked]="(editingReport ? editingReport.metrics : newReport.metrics).includes('department_distribution')"
                           (change)="toggleMetric('department_distribution')"> Department Distribution</label>
              <label><input type="checkbox" 
                           [checked]="(editingReport ? editingReport.metrics : newReport.metrics).includes('performance_metrics')"
                           (change)="toggleMetric('performance_metrics')"> Performance Metrics</label>
              <label><input type="checkbox" 
                           [checked]="(editingReport ? editingReport.metrics : newReport.metrics).includes('security_metrics')"
                           (change)="toggleMetric('security_metrics')"> Security Metrics</label>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelEditReport()">Cancel</button>
            <button type="submit" class="btn btn-primary">
              {{ editingReport ? 'Update Report' : 'Create Report' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Reports List -->
    <div class="reports-container">
      <div class="report-card" *ngFor="let report of reports">
        <div class="report-header">
          <div class="card-avatar"><span>üìä</span></div>
          <div class="report-info">
            <h3>{{ report.name }}</h3>
            <p>{{ report.description }}</p>
          </div>
          <div class="report-type">
            <span class="type-badge">{{ report.type }}</span>
            <span class="custom-badge" *ngIf="report.isCustom">Custom</span>
          </div>
        </div>
        
        <div class="report-details">
          <div class="detail-item">
            <strong>Metrics:</strong> {{ report.metrics.join(', ') }}
          </div>
          <div class="detail-item">
            <strong>Last Generated:</strong> {{ report.lastGenerated | date:'short' }}
          </div>
        </div>
        
        <div class="report-actions">
          <button class="btn btn-primary" 
                  (click)="viewReport(report)"
                  title="View report"
                  aria-label="View report">
            View Report
            <span class="tooltip">View report</span>
          </button>
          <button class="btn btn-secondary" 
                  (click)="editReport(report)"
                  *ngIf="report.isCustom"
                  title="Edit report"
                  aria-label="Edit report">
            Edit
            <span class="tooltip">Edit report</span>
          </button>
          <button class="btn btn-danger" 
                  (click)="deleteReport(report.id)"
                  *ngIf="report.isCustom"
                  title="Delete report"
                  aria-label="Delete report">
            Delete
            <span class="tooltip">Delete report</span>
          </button>
        </div>
      </div>
      <div class="empty-state" *ngIf="reports.length === 0">
        <div class="empty-icon">üìä</div>
        <h3>No Reports</h3>
        <p>Start by creating your first report!<br>Click the + button below. üìà</p>
      </div>
    </div>
  </div>
</div>

<!-- Report View Modal -->
<div class="modal-overlay" *ngIf="showReportModal">
  <div class="modal-card">
    <div class="modal-header">
      <h3>{{ selectedReport?.name }}</h3>
      <button class="btn-icon" (click)="closeReportModal()">√ó</button>
    </div>
    
    <div class="modal-content" *ngIf="selectedReport">
      <div class="report-summary">
        <div class="summary-item">
          <strong>Description:</strong> {{ selectedReport.description }}
        </div>
        <div class="summary-item">
          <strong>Type:</strong> 
          <span class="type-badge">{{ selectedReport.type }}</span>
        </div>
        <div class="summary-item">
          <strong>Metrics:</strong> {{ selectedReport.metrics.join(', ') }}
        </div>
        <div class="summary-item">
          <strong>Last Generated:</strong> {{ selectedReport.lastGenerated | date:'short' }}
        </div>
        <div class="summary-item">
          <strong>Status:</strong> 
          <span class="status-badge" [class.custom]="selectedReport.isCustom">
            {{ selectedReport.isCustom ? 'Custom' : 'System' }}
          </span>
        </div>
      </div>
      
      <div class="report-preview">
        <h4>Report Preview</h4>
        <div class="preview-placeholder">
          <div class="preview-icon">üìä</div>
          <p>Report visualization will be displayed here</p>
          <small>This is a preview of the {{ selectedReport.type }} report</small>
        </div>
      </div>
      
      <div class="report-actions-modal">
        <button class="btn btn-primary" (click)="generateReport(selectedReport.id)">
          Generate Report
        </button>
        <button class="btn btn-secondary" (click)="exportReport(selectedReport.id)">
          Export
        </button>
        <button class="btn btn-secondary" (click)="closeReportModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div> 